<!DOCTYPE html>
<html lang="en">


<% include header %>
<body>
    <div id="checkInFormAnonymous">
    <form action='/add-geo-anonymous' method="post" enctype="multipart/form-data">
	<input type="hidden" name="latitudea" id="latitudea" value=""/>
	<input type="hidden" name="longitudea" id="longitudea" value=""/>
	<input type="submit" value="Check In Anonymously" />
    </form>
    </div>
    <div id="checkInForm">
    <form action='/add-geo' method="post" enctype="multipart/form-data">
	<input type="hidden" name="latitude" id="latitude" value=""/>
	<input type="hidden" name="longitude" id="longitude" value=""/>
	<input type="submit" value="Check In With Name" />
    </form>
    </div>

    <style type="text/css">
      #map-canvas { height: 300px; width:400px; }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAElbKleGQ_ucrGrHsRNJiR2SMGtDGsV2U&sensor=TRUE">
    </script>
    <script type="text/javascript">
      var map;

      
      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(0,0),
          zoom: 8
        };
        map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);
	  
	if(navigator.geolocation) {
	  
	  console.log('navigator.geolocation');
	  navigator.geolocation.getCurrentPosition(currentPositionCallback, errorCallback,{enableHighAccuracy: true});
	} else {
	  alert('The browser does not support geolocation');
	}
	 
      var geoTags = [<%- geotags %>];
      console.log('Printing geotags');
      console.log(geoTags);
	for(var i = 0; i < geoTags.length; i++) {
	   var tmp_lat_long = new google.maps.LatLng(geoTags[i].latitude, geoTags[i].longitude);
	  console.log(tmp_lat_long);
	   var marker = new google.maps.Marker({
	     position: tmp_lat_long,
	     map: map,
	     title: geoTags[i].user
	   });
	   /*
      	   google.maps.event.addListener(marker, 'click', function() {
	      var contentString= '<html><body><div><a href="/profile/' + marker.title + '">User </a></div></body></html>';
	      var infowindow = new google.maps.InfoWindow({
	        content: contentString
	      });
	      infowindow.open(map, marker);
        
           });
	   */
	   if(marker.title != '') {
	   var content = '<html><body><div><a href="/profile/' + marker.title + '">'+ geoTags[i].name +'</a></div></body></html>';
	   var infowindow = new google.maps.InfoWindow();
	   google.maps.event.addListener(marker, 'click', (function(marker, content, infowindow) {
		return function() {
		  infowindow.setContent(content);
		  infowindow.open(map, marker);
		};
	   })(marker, content, infowindow));
	   }
	}
      }

      function errorCallback(error) {
        alert('code: ' + error.code + '\n' + 'message: ' + error.message);
      }
      function currentPositionCallback(position) {
        console.log('getting current position');
	var user_lat_long = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

	document.getElementById('latitude').value = position.coords.latitude;
	document.getElementById('longitude').value = position.coords.longitude;
	document.getElementById('latitudea').value = position.coords.latitude;
	document.getElementById('longitudea').value = position.coords.longitude;
	console.log(document.getElementById('latitude').value);
	console.log(document.getElementById('longitude').value);

/*
	var marker = new google.maps.Marker({
	  position: user_lat_long,
	  map: map
	  });
	  */

	 map.setCenter(user_lat_long);
	 map.setZoom(15);
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    <% include navbar %>
    <div id="map-canvas"/>

        <% include footer %>
    <!-- /container -->
	
    <script type="text/javascript">
        $(document).ready(function() {
            $('#userlist').addClass("active");
        });
    </script>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script
        src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
</body>
</html>
